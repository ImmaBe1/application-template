#Reference: https://www.docker.com/blog/swarmweek-advanced-orchestration-docker-swarm/

version: "3"

#volumes:
#  myapp:

networks:
  appntw:
    driver: bridge
    ipam:
      driver: default
      config:
      - subnet: 172.23.0.0/16
      
services:
  #rng service node 
  rng:
    build: rng
    deploy:
      replicas: 10
    #labels:
    #  loadbalancer: rng-lb
    networks:
      appntw:
        aliases:
          - rng-be

  #rng service load balancer
  rng-lb:
    depends_on:
    - rng
    build: nginxbalancer_rng
    ports:
      - 80:80
  #  volumes:
  #    - myapp:/home/node/app
    networks:
      appntw:
        aliases: 
          - rng

  #hasher service node 
  hasher:
    build: hasher
    #labels:
    #  loadbalancer: rng-lb
    deploy:
      replicas: 10
    networks:
      appntw:
        aliases:
          - hasher-be

  #hasher service load balancer
  hasher-lb:
    depends_on:
    - hasher
    build: nginxbalancer_hasher
    ports:
      - 8080:80
  #  volumes:
  #    - myapp:/home/node/app
    networks:
      appntw:
        aliases: 
          - hasher

  #webui service node
  webui:
    build: webui
    ports:
    - 80
    #volumes:
    #- "./webui/files/:/files/"
    networks:
      appntw:

  #redis service node
  redis:
    image: redis
    networks:
      appntw:

  #worker service node
  worker:
    build: worker
    deploy:
      replicas: 5
    networks:
      appntw:

